var K={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function D(t=256){let n=0,c=new Uint8Array(t);return{get buffer(){return c.buffer},reset(){n=0},bytesView(){return c.subarray(0,n)},bytes(){return c.slice(0,n)},writeByte(i){e(n+1),c[n]=i,n++},writeBytes(i,o=0,r=i.length){e(n+r);for(let l=0;l<r;l++)c[n++]=i[l+o]},writeBytesView(i,o=0,r=i.byteLength){e(n+r),c.set(i.subarray(o,o+r),n),n+=r}};function e(i){var o=c.length;if(o>=i)return;var r=1024*1024;i=Math.max(i,o*(o<r?2:1.125)>>>0),o!=0&&(i=Math.max(i,256));let l=c;c=new Uint8Array(i),n>0&&c.set(l.subarray(0,n),0)}}var R=12,J=5003,st=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function at(t,n,c,e,i,o,r,l){i=i||D(512),o=o||new Uint8Array(256),r=r||new Int32Array(J),l=l||new Int32Array(J);let x=r.length,a=Math.max(2,e);o.fill(0),l.fill(0),I();let s=0,f=0,p=a+1,b=p,g=!1,h=b,A=F(h),u=1<<p-1,C=u+1,y=u+2,_=0,M=c[0],m=0;for(let w=x;w<65536;w*=2)++m;m=8-m,i.writeByte(a),T(u);for(let w=1;w<c.length;w++)E(c[w]);return T(M),T(C),i.writeByte(0),i.bytesView();function d(w){o[_++]=w,_>=254&&k()}function q(){I(),y=u+2,g=!0,T(u)}function I(){r.fill(-1)}function E(w){let v=(w<<R)+M,B=w<<m^M;if(r[B]===v)M=l[B];else{if(r[B]>=0){let S=B===0?1:x-B;do if(B-=S,B<0&&(B+=x),r[B]===v){M=l[B];return}while(r[B]>=0)}T(M),M=w,y<1<<R?(l[B]=y++,r[B]=v):q()}}function k(){_>0&&(i.writeByte(_),i.writeBytesView(o,0,_),_=0)}function F(w){return(1<<w)-1}function T(w){for(s&=st[f],f>0?s|=w<<f:s=w,f+=h;f>=8;)d(s&255),s>>=8,f-=8;if((y>A||g)&&(g?(h=b,A=F(h),g=!1):(++h,h==R?A=1<<R:A=F(h))),w==C){for(;f>0;)d(s&255),s>>=8,f-=8;k()}}}var $=at;function P(t,n,c){return t<<8&63488|n<<2&992|c>>3}function V(t,n,c,e){return t>>4|n&240|(c&240)<<4|(e&240)<<8}function L(t,n,c){return t>>4<<8|n&240|c>>4}function O(t,n,c){return t<n?n:t>c?c:t}function G(t){return t*t}function tt(t,n,c){for(var e=0,i=1e100,o=t[n],r=o.cnt,l=o.ac,x=o.rc,a=o.gc,s=o.bc,f=o.fw;f!=0;f=t[f].fw){var p=t[f].cnt,b=r*p/(r+p);if(!(b>=i)){var g=0;c&&(g+=b*G(t[f].ac-l),g>=i)||(g+=b*G(t[f].rc-x),!(g>=i)&&(g+=b*G(t[f].gc-a),!(g>=i)&&(g+=b*G(t[f].bc-s),!(g>=i)&&(i=g,e=f))))}}o.err=i,o.nn=e}function Q(){return{ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0}}function ut(t,n){let c=n==="rgb444"?4096:65536,e=new Array(c),i=t.length;if(n==="rgba4444")for(let o=0;o<i;++o){let r=t[o],l=r>>24&255,x=r>>16&255,a=r>>8&255,s=r&255,f=V(s,a,x,l),p=f in e?e[f]:e[f]=Q();p.rc+=s,p.gc+=a,p.bc+=x,p.ac+=l,p.cnt++}else if(n==="rgb444")for(let o=0;o<i;++o){let r=t[o],l=r>>16&255,x=r>>8&255,a=r&255,s=L(a,x,l),f=s in e?e[s]:e[s]=Q();f.rc+=a,f.gc+=x,f.bc+=l,f.cnt++}else for(let o=0;o<i;++o){let r=t[o],l=r>>16&255,x=r>>8&255,a=r&255,s=P(a,x,l),f=s in e?e[s]:e[s]=Q();f.rc+=a,f.gc+=x,f.bc+=l,f.cnt++}return e}function H(t,n,c){let{format:e="rgb565",clearAlpha:i=!0,clearAlphaColor:o=0,clearAlphaThreshold:r=0,oneBitAlpha:l=!1}=c||{};if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");let x=new Uint32Array(t.buffer),a=c.useSqrt!==!1,s=e==="rgba4444",f=ut(x,e),p=f.length,b=p-1,g=new Uint32Array(p+1);for(var h=0,u=0;u<f.length;++u){let v=f[u];if(v!=null){var A=1/v.cnt;s&&(v.ac*=A),v.rc*=A,v.gc*=A,v.bc*=A,f[h++]=v}}G(n)/h<.022&&(a=!1);for(var u=0;u<h-1;++u)f[u].fw=u+1,f[u+1].bk=u,a&&(f[u].cnt=Math.sqrt(f[u].cnt));a&&(f[u].cnt=Math.sqrt(f[u].cnt));var C,y,_;for(u=0;u<h;++u){tt(f,u,!1);var M=f[u].err;for(y=++g[0];y>1&&(_=y>>1,!(f[C=g[_]].err<=M));y=_)g[y]=C;g[y]=u}var m=h-n;for(u=0;u<m;){for(var d;;){var q=g[1];if(d=f[q],d.tm>=d.mtm&&f[d.nn].mtm<=d.tm)break;d.mtm==b?q=g[1]=g[g[0]--]:(tt(f,q,!1),d.tm=u);var M=f[q].err;for(y=1;(_=y+y)<=g[0]&&(_<g[0]&&f[g[_]].err>f[g[_+1]].err&&_++,!(M<=f[C=g[_]].err));y=_)g[y]=C;g[y]=q}var I=f[d.nn],E=d.cnt,k=I.cnt,A=1/(E+k);s&&(d.ac=A*(E*d.ac+k*I.ac)),d.rc=A*(E*d.rc+k*I.rc),d.gc=A*(E*d.gc+k*I.gc),d.bc=A*(E*d.bc+k*I.bc),d.cnt+=I.cnt,d.mtm=++u,f[I.bk].fw=I.fw,f[I.fw].bk=I.bk,I.mtm=b}let F=[];var T=0;for(u=0;;++T){let w=O(Math.round(f[u].rc),0,255),v=O(Math.round(f[u].gc),0,255),B=O(Math.round(f[u].bc),0,255),S=255;if(s){if(S=O(Math.round(f[u].ac),0,255),l){let lt=typeof l=="number"?l:127;S=S<=lt?0:255}i&&S<=r&&(w=v=B=o,S=0)}let Z=s?[w,v,B,S]:[w,v,B];if(xt(F,Z)||F.push(Z),(u=f[u].fw)==0)break}return F}function xt(t,n){for(let c=0;c<t.length;c++){let e=t[c],i=e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2],o=e.length>=4&&n.length>=4?e[3]===n[3]:!0;if(i&&o)return!0}return!1}function j(t,n){var c=0,e;for(e=0;e<t.length;e++){let i=t[e]-n[e];c+=i*i}return c}function Y(t,n){return n>1?Math.round(t/n)*n:t}function et(t,{roundRGB:n=5,roundAlpha:c=10,oneBitAlpha:e=null}={}){for(let i=0;i<t.length;i++){let o=t[i],r=o>>24&255,l=o>>16&255,x=o>>8&255,a=o&255;if(r=Y(r,c),e){let s=typeof e=="number"?e:127;r=r<=s?0:255}a=Y(a,n),x=Y(x,n),l=Y(l,n),t[i]=r<<24|l<<16|x<<8|a<<0}}function nt(t,n,c="rgb565"){if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");let e=new Uint32Array(t.buffer),i=c==="rgb444"?4096:65536,o=new Uint8Array(e.length),r=new Array(i),l=c==="rgba4444";if(c==="rgba4444")for(let x=0;x<e.length;x++){let a=e[x],s=a>>24&255,f=a>>16&255,p=a>>8&255,b=a&255,g=V(b,p,f,s),h;r[g]!=null?h=r[g]:(h=gt(b,p,f,s,n),r[g]=h),o[x]=h}else{let x=c==="rgb444"?L:P;for(let a=0;a<e.length;a++){let s=e[a],f=s>>16&255,p=s>>8&255,b=s&255,g=x(b,p,f),h;r[g]!=null?h=r[g]:(h=pt(b,p,f,n),r[g]=h),o[a]=h}}return o}function gt(t,n,c,e,i){let o=0,r=1e100;for(let l=0;l<i.length;l++){let x=i[l],a=x[3],s=U(a-e);if(s>r)continue;let f=x[0];if(s+=U(f-t),s>r)continue;let p=x[1];if(s+=U(p-n),s>r)continue;let b=x[2];s+=U(b-c),!(s>r)&&(r=s,o=l)}return o}function pt(t,n,c,e){let i=0,o=1e100;for(let r=0;r<e.length;r++){let l=e[r],x=l[0],a=U(x-t);if(a>o)continue;let s=l[1];if(a+=U(s-n),a>o)continue;let f=l[2];a+=U(f-c),!(a>o)&&(o=a,i=r)}return i}function rt(t,n,c=5){if(!t.length||!n.length)return;let e=t.map(r=>r.slice(0,3)),i=c*c,o=t[0].length;for(let r=0;r<n.length;r++){let l=n[r];l.length<o?l=[l[0],l[1],l[2],255]:l.length>o?l=l.slice(0,3):l=l.slice();let x=N(e,l.slice(0,3),j),a=x[0],s=x[1];s>0&&s<=i&&(t[a]=l)}}function U(t){return t*t}function W(t,n,c=j){let e=Infinity,i=-1;for(let o=0;o<t.length;o++){let r=t[o],l=c(n,r);l<e&&(e=l,i=o)}return i}function N(t,n,c=j){let e=Infinity,i=-1;for(let o=0;o<t.length;o++){let r=t[o],l=c(n,r);l<e&&(e=l,i=o)}return[i,e]}function ot(t,n,c=j){return t[W(t,n,c)]}function ct(t={}){let{initialCapacity:n=4096,auto:c=!0}=t,e=D(n),i=5003,o=new Uint8Array(256),r=new Int32Array(i),l=new Int32Array(i),x=!1;return{reset(){e.reset(),x=!1},finish(){e.writeByte(K.trailer)},bytes(){return e.bytes()},bytesView(){return e.bytesView()},get buffer(){return e.buffer},get stream(){return e},writeHeader:a,writeFrame(s,f,p,b={}){let{transparent:g=!1,transparentIndex:h=0,delay:A=0,palette:u=null,repeat:C=0,colorDepth:y=8,dispose:_=-1}=b,M=!1;if(c?x||(M=!0,a(),x=!0):M=Boolean(b.first),f=Math.max(0,Math.floor(f)),p=Math.max(0,Math.floor(p)),M){if(!u)throw new Error("First frame must include a { palette } option");dt(e,f,p,u,y),it(e,u),C>=0&&bt(e,C)}let m=Math.round(A/10);ht(e,_,m,g,h);let d=Boolean(u)&&!M;wt(e,f,p,d?u:null),d&&it(e,u),yt(e,s,f,p,y,o,r,l)}};function a(){ft(e,"GIF89a")}}function ht(t,n,c,e,i){t.writeByte(33),t.writeByte(249),t.writeByte(4),i<0&&(i=0,e=!1);var o,r;e?(o=1,r=2):(o=0,r=0),n>=0&&(r=n&7),r<<=2;let l=0;t.writeByte(0|r|l|o),z(t,c),t.writeByte(i||0),t.writeByte(0)}function dt(t,n,c,e,i=8){let o=1,r=0,l=X(e.length)-1,x=o<<7|i-1<<4|r<<3|l,a=0,s=0;z(t,n),z(t,c),t.writeBytes([x,a,s])}function bt(t,n){t.writeByte(33),t.writeByte(255),t.writeByte(11),ft(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),z(t,n),t.writeByte(0)}function it(t,n){let c=1<<X(n.length);for(let e=0;e<c;e++){let i=[0,0,0];e<n.length&&(i=n[e]),t.writeByte(i[0]),t.writeByte(i[1]),t.writeByte(i[2])}}function wt(t,n,c,e){if(t.writeByte(44),z(t,0),z(t,0),z(t,n),z(t,c),e){let i=0,o=0,r=X(e.length)-1;t.writeByte(128|i|o|0|r)}else t.writeByte(0)}function yt(t,n,c,e,i=8,o,r,l){$(c,e,n,i,t,o,r,l)}function z(t,n){t.writeByte(n&255),t.writeByte(n>>8&255)}function ft(t,n){for(var c=0;c<n.length;c++)t.writeByte(n.charCodeAt(c))}function X(t){return Math.max(Math.ceil(Math.log2(t)),1)}var _t=ct;export{ct as GIFEncoder,nt as applyPalette,_t as default,ot as nearestColor,W as nearestColorIndex,N as nearestColorIndexWithDistance,et as prequantize,H as quantize,rt as snapColorsToPalette};
//# sourceMappingURL=gifenc.esm.js.map
